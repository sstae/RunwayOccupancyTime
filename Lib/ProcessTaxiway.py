from shapely import geometry


def initial():

    # TAXI WAY A
    twy_A_1 = geometry.Point(13.92158, 100.60722)
    twy_A_2 = geometry.Point(13.92144, 100.60750)
    twy_A_3 = geometry.Point(13.91994, 100.60660)
    twy_A_4 = geometry.Point(13.92042, 100.60651)

    # TWY B North
    twy_B_north_1 = geometry.Point(13.92848, 100.61011)
    twy_B_north_2 = geometry.Point(13.92761, 100.61177)
    twy_B_north_3 = geometry.Point(13.92733, 100.61198)
    twy_B_north_4 = geometry.Point(13.92664, 100.61221)
    twy_B_north_5 = geometry.Point(13.92620, 100.61195)
    twy_B_north_6 = geometry.Point(13.92633, 100.61171)
    twy_B_north_7 = geometry.Point(13.92707, 100.61155)
    twy_B_north_8 = geometry.Point(13.92724, 100.61142)
    twy_B_north_9 = geometry.Point(13.92754, 100.61086)
    twy_B_north_10 = geometry.Point(13.92755, 100.61059)
    twy_B_north_11 = geometry.Point(13.92708, 100.61029)
    twy_B_north_12 = geometry.Point(13.92745, 100.60953)

    # TAXI WAY C
    twy_C_1 = geometry.Point(13.92674, 100.61095)
    twy_C_2 = geometry.Point(13.92694, 100.61059)
    twy_C_3 = geometry.Point(13.89732, 100.59396)
    twy_C_4 = geometry.Point(13.89713, 100.59431)

    # TWY C South
    twy_C_south_1 = geometry.Point(13.89755, 100.59462)
    twy_C_south_2 = geometry.Point(13.89738, 100.59495)
    twy_C_south_3 = geometry.Point(13.89743, 100.59550)
    twy_C_south_4 = geometry.Point(13.89782, 100.59602)
    twy_C_south_5 = geometry.Point(13.89696, 100.59553)
    twy_C_south_6 = geometry.Point(13.89691, 100.59510)
    twy_C_south_7 = geometry.Point(13.89697, 100.59470)
    twy_C_south_8 = geometry.Point(13.89711, 100.59434)

    # TAXI WAY D1
    twy_D1_1 = geometry.Point(13.92709, 100.61030)
    twy_D1_2 = geometry.Point(13.92694, 100.61057)
    twy_D1_3 = geometry.Point(13.92647, 100.61031)
    twy_D1_4 = geometry.Point(13.92660, 100.61003)

    # TAXI WAY D2
    twy_D2_1 = geometry.Point(13.92670, 100.61103)
    twy_D2_2 = geometry.Point(13.92622, 100.61194)
    twy_D2_3 = geometry.Point(13.92578, 100.61170)
    twy_D2_4 = geometry.Point(13.92629, 100.61079)

    # TAXI WAY D3
    twy_D3_1 = geometry.Point(13.92590, 100.61249)
    twy_D3_2 = geometry.Point(13.92444, 100.61519)
    twy_D3_3 = geometry.Point(13.92409, 100.61497)
    twy_D3_4 = geometry.Point(13.92551, 100.61228)

    # TAXI WAY E1
    twy_E1_1 = geometry.Point(13.92420, 100.60869)
    twy_E1_2 = geometry.Point(13.92407, 100.60897)
    twy_E1_3 = geometry.Point(13.92277, 100.60824)
    twy_E1_4 = geometry.Point(13.92293, 100.60797)

    # TAXI WAY E2
    twy_E2_1 = geometry.Point(13.92337, 100.60913)
    twy_E2_2 = geometry.Point(13.92291, 100.61010)
    twy_E2_3 = geometry.Point(13.92238, 100.60981)
    twy_E2_4 = geometry.Point(13.92286, 100.60885)

    # TAXI WAY F
    twy_F_1 = geometry.Point(13.91960, 100.60699)
    twy_F_2 = geometry.Point(13.91763, 100.60706)
    twy_F_3 = geometry.Point(13.91673, 100.60662)
    twy_F_4 = geometry.Point(13.91907, 100.60668)

    # TAXI WAY G
    twy_G_1 = geometry.Point(13.92000, 100.60628)
    twy_G_2 = geometry.Point(13.91990, 100.60658)
    twy_G_3 = geometry.Point(13.91951, 100.60639)
    twy_G_4 = geometry.Point(13.91926, 100.60594)

    # TAXI WAY H1
    twy_H1_1 = geometry.Point(13.91922, 100.60592)
    twy_H1_2 = geometry.Point(13.91908, 100.60619)
    twy_H1_3 = geometry.Point(13.91779, 100.60545)
    twy_H1_4 = geometry.Point(13.91793, 100.60520)

    # TAXI WAY H2

    twy_H2_1 = geometry.Point(13.91859, 100.60637)
    twy_H2_2 = geometry.Point(13.91818, 100.60617)
    twy_H2_3 = geometry.Point(13.91804, 100.60663)
    twy_H2_4 = geometry.Point(13.91854, 100.60666)

    # TAXI WAY I
    twy_I_1 = geometry.Point(13.91706, 100.60471)
    twy_I_2 = geometry.Point(13.91692, 100.60496)
    twy_I_3 = geometry.Point(13.91561, 100.60423)
    twy_I_4 = geometry.Point(13.91575, 100.60397)

    # TAXI WAY J
    twy_J_1 = geometry.Point(13.91520, 100.60454)
    twy_J_2 = geometry.Point(13.91472, 100.60551)
    twy_J_3 = geometry.Point(13.91433, 100.60529)
    twy_J_4 = geometry.Point(13.91485, 100.60430)

    # TAXI WAY K
    twy_K_1 = geometry.Point(13.91477, 100.60343)
    twy_K_2 = geometry.Point(13.91466, 100.60369)
    twy_K_3 = geometry.Point(13.91346, 100.60301)
    twy_K_4 = geometry.Point(13.91359, 100.60276)

    # TAXI WAY M
    twy_M_1 = geometry.Point(13.91080, 100.60235)
    twy_M_2 = geometry.Point(13.91099, 100.60264)
    twy_M_3 = geometry.Point(13.91135, 100.60235)
    twy_M_4 = geometry.Point(13.91103, 100.60214)

    # TAXI WAY N
    twy_N_1 = geometry.Point(13.91061, 100.60117)
    twy_N_2 = geometry.Point(13.91051, 100.60139)
    twy_N_3 = geometry.Point(13.91008, 100.60113)
    twy_N_4 = geometry.Point(13.91018, 100.60094)

    # TAXI WAY O1
    twy_O1_1 = geometry.Point(13.90997, 100.60079)
    twy_O1_2 = geometry.Point(13.91006, 100.60102)
    twy_O1_3 = geometry.Point(13.91002, 100.60116)
    twy_O1_4 = geometry.Point(13.90967, 100.60100)
    twy_O1_5 = geometry.Point(13.90941, 100.60055)

    # TAXI WAY O2
    twy_O2_1 = geometry.Point(13.91051, 100.60187)
    twy_O2_2 = geometry.Point(13.91167, 100.60378)
    twy_O2_3 = geometry.Point(13.91096, 100.60330)
    twy_O2_4 = geometry.Point(13.91007, 100.60167)

    # TAXI WAY P
    twy_P_1 = geometry.Point(13.90643, 100.59956)
    twy_P_2 = geometry.Point(13.90604, 100.59993)
    twy_P_3 = geometry.Point(13.90579, 100.59953)
    twy_P_4 = geometry.Point(13.90600, 100.59932)

    # TAXI WAY R1
    twy_R1_1 = geometry.Point(13.90553, 100.59832)
    twy_R1_2 = geometry.Point(13.90546, 100.59854)
    twy_R1_3 = geometry.Point(13.90457, 100.59803)
    twy_R1_4 = geometry.Point(13.90428, 100.59755)

    # TAXI WAY R2
    twy_R2_1 = geometry.Point(13.90548, 100.59903)
    twy_R2_2 = geometry.Point(13.90667, 100.60102)
    twy_R2_3 = geometry.Point(13.90608, 100.60064)
    twy_R2_4 = geometry.Point(13.90496, 100.59871)

    # TAXI WAY S1
    twy_S1_1 = geometry.Point(13.90367, 100.59813)
    twy_S1_2 = geometry.Point(13.90338, 100.59907)
    twy_S1_3 = geometry.Point(13.90282, 100.59876)
    twy_S1_4 = geometry.Point(13.90325, 100.59790)

    # TAXI WAY S2
    twy_S2_1 = geometry.Point(13.90272, 100.59970)
    twy_S2_2 = geometry.Point(13.90149, 100.60221)
    twy_S2_3 = geometry.Point(13.90115, 100.60203)
    twy_S2_4 = geometry.Point(13.90241, 100.59955)

    # TAXI WAY Y
    twy_Y_1 = geometry.Point(13.90126, 100.60148)
    twy_Y_2 = geometry.Point(13.90101, 100.60194)
    twy_Y_3 = geometry.Point(13.89964, 100.60117)
    twy_Y_4 = geometry.Point(13.89985, 100.60095)
    twy_Y_5 = geometry.Point(13.90020, 100.60092)

    # TAXI WAY X
    twy_X_1 = geometry.Point(13.92801, 100.61573)
    twy_X_2 = geometry.Point(13.92787, 100.61515)
    twy_X_3 = geometry.Point(13.92528, 100.61364)
    twy_X_4 = geometry.Point(13.92508, 100.61401)
    twy_X_5 = geometry.Point(13.92748, 100.61538)
    twy_X_6 = geometry.Point(13.92757, 100.61574)
    twy_X_7 = geometry.Point(13.92708, 100.61665)
    twy_X_8 = geometry.Point(13.92744, 100.61686)

    # Create close shape from point lists
    point_list_taxiway_a = [twy_A_1, twy_A_2, twy_A_3, twy_A_4, twy_A_1]
    point_list_taxiway_b_north = [twy_B_north_1, twy_B_north_2, twy_B_north_3, twy_B_north_4, twy_B_north_5, twy_B_north_6,
                                  twy_B_north_7, twy_B_north_8, twy_B_north_9, twy_B_north_10, twy_B_north_11, twy_B_north_12,
                                  twy_B_north_1]
    point_list_taxiway_c = [twy_C_1,  twy_C_2,  twy_C_3,  twy_C_4,  twy_C_1]
    point_list_taxiway_c_south = [twy_C_south_1, twy_C_south_2, twy_C_south_3, twy_C_south_4, twy_C_south_5, twy_C_south_6,
                                  twy_C_south_7, twy_C_south_8, twy_C_south_1]
    point_list_taxiway_d1 = [twy_D1_1, twy_D1_2, twy_D1_3, twy_D1_4, twy_D1_1]
    point_list_taxiway_d2 = [twy_D2_1, twy_D2_2, twy_D2_3, twy_D2_4, twy_D2_1]
    point_list_taxiway_d3 = [twy_D3_1, twy_D3_2, twy_D3_3, twy_D3_4, twy_D3_1]
    point_list_taxiway_e1 = [twy_E1_1, twy_E1_2, twy_E1_3, twy_E1_4, twy_E1_1]
    point_list_taxiway_e2 = [twy_E2_1, twy_E2_2, twy_E2_3, twy_E2_4, twy_E2_1]
    point_list_taxiway_f = [twy_F_1, twy_F_2, twy_F_3, twy_F_4, twy_F_1]
    point_list_taxiway_g = [twy_G_1, twy_G_2, twy_G_3, twy_G_4, twy_G_1]
    point_list_taxiway_h1 = [twy_H1_1, twy_H1_2, twy_H1_3, twy_H1_4, twy_H1_1]
    point_list_taxiway_h2 = [twy_H2_1, twy_H2_2, twy_H2_3, twy_H2_4, twy_H2_1]
    point_list_taxiway_i = [twy_I_1, twy_I_2, twy_I_3, twy_I_4, twy_I_1]
    point_list_taxiway_j = [twy_J_1, twy_J_2, twy_J_3, twy_J_4, twy_J_1]
    point_list_taxiway_k = [twy_K_1, twy_K_2, twy_K_3, twy_K_4, twy_K_1]
    point_list_taxiway_m = [twy_M_1, twy_M_2, twy_M_3, twy_M_4, twy_M_1]
    point_list_taxiway_n = [twy_N_1, twy_N_2, twy_N_3, twy_N_4, twy_N_1]
    point_list_taxiway_o1 = [twy_O1_1, twy_O1_2, twy_O1_3, twy_O1_4, twy_O1_5, twy_O1_1]
    point_list_taxiway_o2 = [twy_O2_1, twy_O2_2, twy_O2_3, twy_O2_4, twy_O2_1]
    point_list_taxiway_p = [twy_P_1, twy_P_2, twy_P_3, twy_P_4, twy_P_1]
    point_list_taxiway_r1 = [twy_R1_1, twy_R1_2, twy_R1_3, twy_R1_4, twy_R1_1]
    point_list_taxiway_r2 = [twy_R2_1, twy_R2_2, twy_R2_3, twy_R2_4, twy_R2_1]
    point_list_taxiway_s1 = [twy_S1_1, twy_S1_2, twy_S1_3, twy_S1_4, twy_S1_1]
    point_list_taxiway_s2 = [twy_S2_1, twy_S2_2, twy_S2_3, twy_S2_4, twy_S2_1]
    point_list_taxiway_y = [twy_Y_1, twy_Y_2, twy_Y_3, twy_Y_4, twy_Y_5, twy_Y_1]
    point_list_taxiway_x = [twy_X_1, twy_X_2, twy_X_3, twy_X_4, twy_X_5, twy_X_6, twy_X_7, twy_X_8, twy_X_1]

    # Create Polygon
    polygon_taxiway_a = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_a])
    polygon_taxiway_b_north = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_b_north])
    polygon_taxiway_c = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_c])
    polygon_taxiway_c_south = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_c_south])
    polygon_taxiway_d1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_d1])
    polygon_taxiway_d2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_d2])
    polygon_taxiway_d3 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_d3])
    polygon_taxiway_e1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_e1])
    polygon_taxiway_e2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_e2])
    polygon_taxiway_f = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_f])
    polygon_taxiway_g = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_g])
    polygon_taxiway_h1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_h1])
    polygon_taxiway_h2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_h2])
    polygon_taxiway_i = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_i])
    polygon_taxiway_j = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_j])
    polygon_taxiway_k = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_k])
    polygon_taxiway_m = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_m])
    polygon_taxiway_n = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_n])
    polygon_taxiway_o1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_o1])
    polygon_taxiway_o2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_o2])
    polygon_taxiway_p = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_p])
    polygon_taxiway_r1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_r1])
    polygon_taxiway_r2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_r2])
    polygon_taxiway_s1 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_s1])
    polygon_taxiway_s2 = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_s2])
    polygon_taxiway_y = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_y])
    polygon_taxiway_x = geometry.Polygon([[p.x, p.y] for p in point_list_taxiway_x])

    # Put polygon into Dictionary
    taxi_dict = {
        "taxiway_a": polygon_taxiway_a,
        "taxiway_b_north": polygon_taxiway_b_north,
        "taxiway_c": polygon_taxiway_c,
        "taxiway_c_south": polygon_taxiway_c_south,
        "taxiway_d1": polygon_taxiway_d1,
        "taxiway_d2": polygon_taxiway_d2,
        "taxiway_d3": polygon_taxiway_d3,
        "taxiway_e1": polygon_taxiway_e1,
        "taxiway_e2": polygon_taxiway_e2,
        "taxiway_f": polygon_taxiway_f,
        "taxiway_g": polygon_taxiway_g,
        "taxiway_h1": polygon_taxiway_h1,
        "taxiway_h2": polygon_taxiway_h2,
        "taxiway_i": polygon_taxiway_i,
        "taxiway_j": polygon_taxiway_j,
        "taxiway_k": polygon_taxiway_k,
        "taxiway_m": polygon_taxiway_m,
        "taxiway_n": polygon_taxiway_n,
        "taxiway_o1": polygon_taxiway_o1,
        "taxiway_o2": polygon_taxiway_o2,
        "taxiway_p": polygon_taxiway_p,
        "taxiway_r1": polygon_taxiway_r1,
        "taxiway_r2": polygon_taxiway_r2,
        "taxiway_s1": polygon_taxiway_s1,
        "taxiway_s2": polygon_taxiway_s2,
        "taxiway_y": polygon_taxiway_y,
        "taxiway_x": polygon_taxiway_x}
    return taxi_dict


def process_by_line(config, flight_info, content):
    if "taxi" not in flight_info:
        # first time
        flight_info["taxi"] = {"taxi": "unknown", "taxi_layout": initial(), "taxi_dict": {}}
    latitude = content['position']['lat']
    longitude = content['position']['lon']
    t1 = geometry.Point(latitude, longitude)
    taxi_layout = flight_info["taxi"]["taxi_layout"]
    taxi_dict = flight_info["taxi"]["taxi_dict"]
    # for loop since zone1 until zone11
    current_taxi = "not_taxi"
    for taxi_name in taxi_layout:
        if taxi_layout[taxi_name].intersects(t1):
            current_taxi = taxi_name
            break
    # if the first lat/lon is not in zone1, it will create "" for the first value in the listoftaxi.
    if current_taxi not in taxi_dict:
        taxi_dict[current_taxi] = {"first": content["data_time"], "last": content["data_time"]}
    else:
        taxi_dict[current_taxi]["last"] = content["data_time"]


def process_final(config, flight_info):
    if ("taxi" not in flight_info) or ("direction" not in flight_info):
        print('cannot process taxi summary')
    else:
        taxi_dict = flight_info["taxi"]["taxi_dict"]
        direction = flight_info["direction"]["direction"]
        if direction == "arrival":
            flight_info["taxi"]["taxi"] = get_first_taxi(taxi_dict)
        elif direction == "departure":
            flight_info["taxi"]["taxi"] = get_last_taxi(taxi_dict)
        else:
            flight_info["taxi"]["taxi"] = "unknown"


def get_last_taxi(taxi_dict):
    last_taxi = ""
    last_datetime = None
    for key in taxi_dict:
        if key != "not_taxi":
            if (last_taxi == "") or (taxi_dict[key]["last"] > last_datetime):
                last_taxi = key
                last_datetime = taxi_dict[key]["last"]
    if last_taxi == "":
        return "unknown"
    else:
        return last_taxi


def get_first_taxi(taxi_dict):
    first_taxi = ""
    first_datetime = None
    for key in taxi_dict:
        if key != "not_taxi":
            if (first_taxi == "") or (taxi_dict[key]["first"] < first_datetime):
                first_taxi = key
                first_datetime = taxi_dict[key]["first"]
    if first_taxi == "":
        return "unknown"
    else:
        return first_taxi
